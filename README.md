## Руководство по скачиванию и запуску проекта

### Скачивание проекта с GitHub

1. Откройте браузер и перейдите по ссылке: [https://github.com/menfara/TechOrdaBot](https://github.com/menfara/TechOrdaBot).
2. На странице проекта нажмите на зеленую кнопку **Code**.
3. Выберите **Download ZIP**, чтобы скачать архив с проектом на ваш компьютер.
4. После завершения загрузки, распакуйте архив в удобное для вас место на компьютере.

### Открытие проекта в PyCharm

1. Запустите PyCharm.
2. В стартовом окне выберите **Open** (если у вас уже открыт проект, выберите **File** > **Open** в верхнем меню).
3. Найдите папку, в которую вы распаковали архив, и выберите её.
4. Нажмите кнопку **OK**.

### Настройка окружения Python

1. В PyCharm откройте настройки проекта: **File** > **Settings** (или **PyCharm** > **Preferences** на macOS).
2. В левой панели выберите **Project: [название вашего проекта]** > **Python Interpreter**.
3. Нажмите на иконку шестеренки справа и выберите **Add**.
4. В появившемся окне выберите **New environment using** и выберите **Virtualenv**.
5. Убедитесь, что выбрана правильная версия Python, и нажмите **OK**.
6. PyCharm автоматически создаст новое виртуальное окружение и установит все необходимые зависимости из файла `requirements.txt`.

### Запуск проекта

1. Найдите главный файл вашего проекта. Это файл с именем `main.py`.
2. Откройте этот файл и убедитесь, что он содержит точку входа для запуска приложения.
3. Нажмите правой кнопкой мыши на файле и выберите **Run 'имя файла'**.

Теперь проект должен запуститься в PyCharm.

## Внесение изменений в проект с помощью PyCharm и push в GitHub
1. **Редактирование файлов**: Внесите необходимые изменения в файлы вашего проекта. Используйте встроенные инструменты PyCharm для редактирования кода, отладки и тестирования.
2. **Сохранение изменений**: Сохраните изменения, нажав `Ctrl + S` (Windows/Linux) или `Cmd + S` (Mac).

### 3. Управление версиями с Git в PyCharm

1. **Просмотр изменений**: Перейдите в `View` > `Tool Windows` > `Version Control` (или используйте `Alt + 9`), чтобы открыть окно управления версиями. Здесь вы увидите все измененные файлы.
2. **Добавление изменений в индекс (staging)**:
   - Выберите файлы, которые вы хотите добавить в индекс.
   - Щелкните правой кнопкой мыши и выберите `Git` > `Add` (или используйте сочетание клавиш `Ctrl + Alt + A`).
3. **Создание коммита**:
   - Нажмите на `Commit` в верхней панели или используйте сочетание клавиш `Ctrl + K`.
   - Введите сообщение коммита, описывающее внесенные изменения.
   - Нажмите `Commit` или `Commit and Push`, если хотите сразу отправить изменения в удаленный репозиторий.

### 4. Push изменений в GitHub

1. **Push изменений**:
   - Если вы не нажали `Commit and Push` ранее, выберите `Git` > `Push` в верхнем меню или используйте сочетание клавиш `Ctrl + Shift + K`.
   - Подтвердите push, проверив информацию об изменениях, которые будут отправлены в удаленный репозиторий.
   - Нажмите `Push`.
  
### 5. Проверка изменений на GitHub

1. **Проверка репозитория**:
   - Перейдите на страницу вашего репозитория на GitHub.
   - Убедитесь, что ваши изменения успешно появились в репозитории.

### 6. Добавление файла конфигурации

После внесения изменений в проект, убедитесь, что вы вручную добавили файл конфигурации `.json`, содержащий секретные данные о Google Sheets Reader. Этот файл должен включать такие данные, как почта сервисного аккаунта и другие необходимые параметры.

Файл должен быть размещен в корневой директории проекта или в указанной документацией директории конфигурации.


### 7. Обновление версии проекта

После того, как вы отправите изменения в GitHub, сообщите администратору сервера о необходимости обновления версии проекта. Это гарантирует, что развернутая версия проекта будет синхронизирована с последними изменениями.




### Примечания

- **Синхронизация с удаленным репозиторием**: Если у вас есть изменения в удаленном репозитории, выполните `Pull` перед началом работы, чтобы избежать конфликтов.
- **Конфликты**: В случае конфликтов при merge, PyCharm предоставит инструменты для их разрешения.
- Видео руководство по использованию PyCharm и GitHub: https://www.youtube.com/watch?v=IH0W5bm4orc.

Следуя этим шагам, вы сможете легко вносить изменения в проект, используя PyCharm, и отправлять их в GitHub.



# Руководство пользователя для администратора

## Изменение URL Google Таблиц

Как администратор, вы можете изменить URL Google Таблиц, которые бот использует для оценки NPS IT-школ. Для этого выполните следующие шаги:

1. **Откройте ваш чат с ботом в Telegram**:
   - Убедитесь, что вы находитесь в чате, где можете отправлять сообщения боту.

2. **Отправьте команду для изменения URL Google Таблиц**:
   - Введите следующую команду, заменив `[ссылка на страницу Google Таблицы]` на фактический URL страницы Google Таблицы, которую вы хотите использовать:
     ```
     pass123 [ссылка на страницу Google Таблицы]
     ```
   - Пример:
     ```
     pass123 https://docs.google.com/spreadsheets/d/1abcdEFGHIJklmnopQRSTUVWXyz1234567890/edit#gid=0
     ```

3. **Подтверждение**:
   - Бот обновит свою конфигурацию и начнет использовать новый URL Google Таблиц для получения данных NPS IT-школ.

### Примечания
- Убедитесь, что новый URL Google Таблиц доступен и у вас есть необходимые разрешения для доступа бота к этой таблице.
- **Важно:** Почта бота `google-sheets-reader@astanahubproject.iam.gserviceaccount.com` должна быть добавлена в редакторы этой Google Таблицы.
- **Напоминание:** В разных страницах (вкладках) таблицы разные ссылки, и бот читает данные именно с той страницы, на которую указывает предоставленная ссылка.
- **Обновление данных:** При обновлении ссылки на страницу бот читает BIN и сгенерированный 6-значный ID для IT-школ и связывает их. Эти данные находятся на странице таблицы с двумя колонками: BIN и ID. Если ID какой-то школы было обновлено в таблице с ID, то необходимо передать боту ссылку на страницу с NPS еще раз для обновления локальных ID у бота.

# Структура проекта

- `docs/` — папка с документами
- `README.md` — файл с документацией проекта
- `config.ini` — конфигурационный файл с токеном бота, ссылкой на Google Таблицу и ID чата с администраторами
- `google_sheets_reader.py` — файл с кодом для работы с Google Таблицами
- `main.py` — главный файл с кодом бота
- `requirements.txt` — файл с зависимостями (библиотеки)
- `translations.py` — файл со строками, используемыми в проекте


Следуя этим шагам, вы можете легко изменить источник Google Таблиц, используемых ботом для данных NPS.



## ClientStatusSelectionScene

Класс `ClientStatusSelectionScene` используется для предоставления пользователям возможности выбрать статус их обучения. Он наследует от класса `State`.

### Методы

#### `enter`

Метод `enter` вызывается при входе в сцену выбора статуса клиента.

- **Параметры**:
  - `update` (объект `Update`): объект обновления, содержащий данные о событии.
  - `context` (объект `ContextTypes.DEFAULT_TYPE`): объект контекста, содержащий данные о текущем состоянии бота.

- **Основные моменты**:
  - **Сообщение при входе**:
    Создание и отправка сообщения пользователю с предложением выбрать статус:
    ```python
    message = escape_markdown(Translations.status_prompt[self.language])
    message = message.replace('\<b\>', '*').replace('\</b\>', '*')

    await update.callback_query.message.reply_text(message,
                                                   reply_markup=reply_markup, parse_mode='MarkdownV2')
    ```
  - **Вывод клавиатуры**:
    Создание клавиатуры с кнопками для выбора статуса:
    ```python
    keyboard = [
        [
            InlineKeyboardButton(Translations.status_not_started[self.language], callback_data=self.STATUS_NOT_STARTED),
        ],
        [
            InlineKeyboardButton(Translations.status_teaching[self.language], callback_data=self.STATUS_TEACHING),
        ],
        [
            InlineKeyboardButton(Translations.status_finished[self.language], callback_data=self.STATUS_FINISHED)
        ],
        [
            InlineKeyboardButton(Translations.contact_admin_button[self.language], callback_data='contact_admin')
        ],
        [
            InlineKeyboardButton(Translations.back[self.language], callback_data='back')
        ],
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    ```

#### `handle_callback`

Метод `handle_callback` вызывается при нажатии на одну из кнопок выбора статуса.

- **Параметры**:
  - `update` (объект `Update`): объект обновления, содержащий данные о событии.
  - `context` (объект `ContextTypes.DEFAULT_TYPE`): объект контекста, содержащий данные о текущем состоянии бота.

- **Основные моменты**:
  - **Обработка нажатия на клавишы**:
    Обработка нажатия кнопки и установка выбранного статуса:
    Переход в соответствующую сцену после выбора статуса - TeachingNotStarted/TeachingStarted/TeachingFinished.
    ```python
    query = update.callback_query
    await query.answer()
    selected_status = query.data

    if selected_status == self.STATUS_NOT_STARTED:
        await self.bot.transition_to(TeachingNotStartedScene(self.bot, self.language), update, context)
    if selected_status == self.STATUS_TEACHING:
        await self.bot.transition_to(TeachingStartedScene(self.bot, self.language), update, context)
    if selected_status == self.STATUS_FINISHED:
        await self.bot.transition_to(TeachingFinishedScene(self.bot, self.language), update, context)
    ```
